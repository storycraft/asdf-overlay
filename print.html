<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Asdf Overlay Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Asdf Overlay Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to Asdf Overlay.
Asdf Overlay provides an easy to use interface to draw on top of windows.
It is primarily targeting games, but it can be used on any programs using GPU.</p>
<ol>
<li>Automatic graphics backend detection</li>
<li>GPU accelerated shared overlay surface</li>
<li>Input passthrough control</li>
</ol>
<p><img src="introduction/example.png" alt="Example image" /></p>
<p>By reading the documentation you will learn how to</p>
<ol>
<li>Setup development environment and building the library</li>
<li>Position overlay surface in multiple way</li>
<li>Control input passthrough</li>
</ol>
<h2 id="supported-graphics-backend"><a class="header" href="#supported-graphics-backend">Supported graphics backend</a></h2>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
OpenGL</li>
<li><input disabled="" type="checkbox" checked=""/>
DX9</li>
<li><input disabled="" type="checkbox" checked=""/>
DX11</li>
<li><input disabled="" type="checkbox" checked=""/>
DX12</li>
<li><input disabled="" type="checkbox" checked=""/>
Vulkan (via loading as vulkan layer)</li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>This project is dual licensed under MIT or Apache-2.0 License.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerequirements"><a class="header" href="#prerequirements">Prerequirements</a></h1>
<p>To build Asdf Overlay, you need prerequirements.
Click each items below, follow the install instructions.</p>
<ul>
<li><a href="https://nodejs.org/en/download">Node.js</a></li>
<li><a href="https://visualstudio.microsoft.com/">Microsoft Visual C++ Compiler</a> for x86, x64 and ARM64</li>
<li><a href="https://www.rust-lang.org/tools/install">Rust</a></li>
<li><a href="https://git-scm.com/downloads">Git</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="workspace-setup"><a class="header" href="#workspace-setup">Workspace Setup</a></h1>
<p>To setup Asdf Overlay workspace, you will first need to clone the repository.</p>
<p>Following command can be used to clone Github repository.</p>
<pre><code class="language-bash">git clone https://github.com/storycraft/asdf-overlay
</code></pre>
<p>After cloning repository, change the current directory.</p>
<pre><code class="language-bash">cd asdf-overlay
</code></pre>
<p>Initialize and update submodules by using a command below.</p>
<pre><code class="language-bash">git submodule update --init --recursive
</code></pre>
<p>Finish by installing node dependencies.</p>
<pre><code class="language-bash">pnpm install
</code></pre>
<h2 id="building-project"><a class="header" href="#building-project">Building project</a></h2>
<p>Once you done set up workspace, you can build the project using following command.</p>
<pre><code class="language-bash">pnpm build
</code></pre>
<p>For more detail, see <a href="developer-guide/./pnpm/build.html">Pnpm Command - build</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>By default, release build will not emit any logs due to performance overhead.
To debug overlay DLL, you need to build with debug profile.</p>
<p>To build overlay DLL with debug profile, following command can be used.</p>
<pre><code class="language-bash">pnpm build-dll
</code></pre>
<p>After building, replace overlay DLL.
Overlay DLL with debug profile will emit tracing to Debug Output Window.
Use external debug log viewer (ex: <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/debugview">DebugView</a>) to see debug output.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nodejs-electron-user-guide"><a class="header" href="#nodejs-electron-user-guide">Node.js (Electron) User Guide</a></h1>
<p>This section provides information on how to use Asdf Overlay with Node.js and Electron.</p>
<ul>
<li><strong><a href="user-guide/./node/installation.html">Installation</a></strong> Instructions on how to install Asdf Overlay for Node.js and Electron.</li>
<li><strong><a href="user-guide/./node/attaching.html">Attaching to target process</a></strong> Guide on how to attach Asdf Overlay to a target process.</li>
<li><strong><a href="user-guide/./node/closing.html">Closing the connection</a></strong> Instructions on how to properly close the Asdf Overlay connection in a Node.js environment.</li>
<li><strong><a href="user-guide/./node/obtaining-window-info.html">Obtaining window information</a></strong> Guide on how to obtain main window information of target application.</li>
<li><strong><a href="user-guide/./node/layout-surface-connection.html">Layout and Surface connection</a></strong> Guide on how to layout overlay surface and connect overlay surface to target window in Electron.</li>
<li><strong><a href="user-guide/./node/input-control.html">Input Control</a></strong> Guide on how to control input events and passthrough of overlay window.</li>
</ul>
<p>For more examples, see example projects in the <code>examples/node</code> directory of the repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>Following command will install core Node.js package and Electron integration package</p>
<pre><code class="language-bash">npm install @asdf-overlay/core @asdf-overlay/electron
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="attaching-to-target-process"><a class="header" href="#attaching-to-target-process">Attaching to target process</a></h1>
<p>To control overlay, you first need to attach overlay dll to target process.
The <code>@asdf-overlay/core</code> package provides a function for attaching overlay and initialize IPC connection.</p>
<p>Following code connects overlay to target process.</p>
<pre><code class="language-typescript">import { defaultDllDir, Overlay } from '@asdf-overlay/core';

const overlay = await Overlay.attach(
  defaultDllDir().replace('app.asar', 'app.asar.unpacked'),
  /* target process id */ 12345,
  /* optional timeout in ms */ 5000,
);
</code></pre>
<p>Some caveats included below:</p>
<ol>
<li><code>@asdf-overlay/core</code> package includes overlay dll files for x64, ia32 and arm64 architectures.
Asdf overlay will choose appropriate one based on the target process architecture.
The <code>defaultDllDir</code> function returns path to the directory containing these dll files.</li>
<li>Onced injected, the dll will not be unloaded until the target process exits and maybe reused later if another connection is established.</li>
<li>If optional timeout is not provided, it will wait indefinitely.</li>
<li>The <code>Overlay.attach</code> function returns an <code>Overlay</code> instance upon successful attachment and can be used to control the overlay.</li>
<li>On Electron, <code>@asdf-overlay/core</code> must be specified as external to work correctly.</li>
<li>On Electron, <code>defaultDllDir</code> function may return path inside <code>app.asar</code> archive.
In such cases, you need to replace <code>app.asar</code> with <code>app.asar.unpacked</code> to access the dll files.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="closing-the-connection"><a class="header" href="#closing-the-connection">Closing the connection</a></h1>
<p>After opening a connection to Asdf Overlay, it is important to close the connection properly to free up resources.
The <code>Overlay</code> instance provides a method to close the connection and unload the overlay dll from the target process.</p>
<p>Following code demonstrates how to close the overlay connection.</p>
<pre><code class="language-typescript">import { Overlay } from '@asdf-overlay/core';

const overlay: Overlay = /* previously attached Overlay instance */;
overlay.destroy();
</code></pre>
<p>Some caveats included below:</p>
<ol>
<li>After calling the <code>destroy</code> method, the overlay setup in the target process will be reset, and the resources will be released.</li>
<li>You cannot use the <code>Overlay</code> instance after calling this method.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="obtaining-window-information"><a class="header" href="#obtaining-window-information">Obtaining Window Information</a></h1>
<p>Before showing overlay, you need to specify which window to show overlay.
In most case, you need to obtain main window information of target application.</p>
<p>This heuristic code can be used to obtain main window information.</p>
<pre><code class="language-typescript">const [id, luid] = await new Promise&lt;[number, GpuLuid]&gt;(resolve =&gt; overlay.event.once(
  'added',
  (id, _width, _height, luid) =&gt; {
    resolve([id, luid]);
  }),
);
</code></pre>
<p>It will return first found window ID and its associated GPU LUID.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="layout-and-surface-connection"><a class="header" href="#layout-and-surface-connection">Layout and Surface connection</a></h1>
<p>This section explains how to layout overlay surface and connect overlay surface to target window in Electron.</p>
<h2 id="layout"><a class="header" href="#layout">Layout</a></h2>
<p>After obtaining window id, you can set overlay layout using various options.</p>
<p>There are two types of specifying length: absolute length in pixels and relative length in percentage.</p>
<p>Relative length is specified as a number between <code>0.0</code> and <code>1.0</code>, representing percentage of target window size.</p>
<p>Layout can be done using <code>setPosition</code>, <code>setAnchor</code> and <code>setMargin</code> methods of <code>Overlay</code> instance.</p>
<pre><code class="language-typescript">import { Overlay, percent, length } from '@asdf-overlay/core';

const overlay: Overlay = /* Attached Overlay instance */;
const id: number = /* Id of target window */;

// Set position to center of target window
await overlay.setPosition(id, percent(0.5), percent(0.5));
// Set anchor to center of overlay surface
await overlay.setAnchor(id, percent(0.5), percent(0.5));
// Set margin to 10 pixels from each side
await overlay.setMargin(id, length(10), length(10), length(10), length(10));
</code></pre>
<ul>
<li><strong>Position</strong>: Specifies the position of overlay surface relative to target window's client area.
The position is determined by the anchor point of overlay surface.</li>
<li><strong>Anchor</strong>: Specifies the anchor point of overlay surface.
The anchor point is a point on the overlay surface that will be aligned to the position in the target window.</li>
<li><strong>Margin</strong>: Specifies the margin between overlay surface and target window's client area.
Margin is specified for each side: top, right, bottom and left.</li>
</ul>
<h2 id="surface-connection"><a class="header" href="#surface-connection">Surface connection</a></h2>
<p>After obtaining main window information, you can connect overlay surface to show overlay.
By using <code>@asdf-overlay/electron</code> package, you can easily connect Electron window as overlay surface.</p>
<p>Code example is shown below.</p>
<pre><code class="language-typescript">import { Overlay } from '@asdf-overlay/core';
import { ElectronOverlaySurface, type OverlayWindow } from '@asdf-overlay/electron';

const overlay: Overlay = /* Attached Overlay instance */;
const windowId: number = /* Id of target window */;
const gpuLuid: GpuLuid = /* GPU LUID of target window */;
const window: OverlayWindow = { id: windowId, overlay };

const mainWindow = new BrowserWindow({
  webPreferences: {
    offscreen: {
      useSharedTexture: true,
    },
  },
});

const surface = ElectronOverlaySurface.connect(window, gpuLuid, mainWindow.webContents);

// Disconnecting surface
await surface.disconnect();
</code></pre>
<p>Caveats include:</p>
<ol>
<li>Make sure to enable <code>offscreen.useSharedTexture</code> in <code>webPreferences</code> when creating <code>BrowserWindow</code>.
Without this option, overlay will be presented using CPU which causes high latency and low performance.</li>
<li>You need to provide correct <code>GpuLuid</code> when connecting surface.
On hybrid GPU systems like laptops with integrated and discrete GPUs, providing wrong <code>GpuLuid</code> will result in no overlay shown.</li>
<li>While overlay position can be changed, size is fixed to connected surface texture.
To change size of surface, change the size of browser.
<code>ElectronOverlaySurface</code> instance takes care of resizing overlay surface automatically.</li>
<li>To disconnect surface, call <code>disconnect</code> method of <code>ElectronOverlaySurface</code> instance.
This will disconnect and release surface resources.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="input-control"><a class="header" href="#input-control">Input Control</a></h1>
<p>This section provides a guide on how to listen to input events and control input passthrough to overlay window.</p>
<h2 id="listening-to-input-events"><a class="header" href="#listening-to-input-events">Listening to input events</a></h2>
<p>To listen to input events going to the overlay window, you can use <code>listenInput</code> method from the <code>Overlay</code> instance.
This method allows you to listen cursor and keyboard events using event listeners.</p>
<p>Example:</p>
<pre><code class="language-typescript">import { Overlay } from '@asdf-overlay/core';

const overlay: Overlay = /* Attached Overlay instance */;
const windowId: number = /* Target window ID */;

await overlay.listenInput(
  windowId,
  true, /* listen to cursor events */
  true, /* listen to keyboard events */
);

// Register listener for cursor events
overlay.on('cursor_input', (windowId, event) =&gt; {
  // Cursor event listener 
});

// Register listener for keyboard events
overlay.on('keyboard_input', (windowId, event) =&gt; {
  // Keyboard event listener 
});
</code></pre>
<p>Caveats:</p>
<ol>
<li>Raw input will not be captured as you can register platform specific raw input listeners.</li>
<li>Listening to unnecessary input events may cause performance issues.</li>
<li>IME input events are provided as best-effort basis and may not work as expected in all cases.</li>
</ol>
<h2 id="controlling-input-passthrough"><a class="header" href="#controlling-input-passthrough">Controlling input passthrough</a></h2>
<p>Sometimes you may want to control whether input events are passed through to the underlying window or not.
For example, you may want to show interactive overlay UI and you don't want input events to reach the underlying window.</p>
<p>By using <code>blockInput</code> method from the <code>Overlay</code> instance, you can block or unblock input events reaching the underlying window.</p>
<p>Example:</p>
<pre><code class="language-typescript">import { Overlay } from '@asdf-overlay/core';

const overlay: Overlay = /* Attached Overlay instance */;
const windowId: number = /* Target window ID */;

await overlay.blockInput(
  windowId,
  block, // true to block input, false to unblock input
);

overlay.event.on('input_blocking_ended', () =&gt; {
  // Event listener called when input blocking ends
});
</code></pre>
<p>Caveats:</p>
<ol>
<li>All input events will be captured, regardless of whether you are listening to them or not.</li>
<li>Raw input will be blocked.</li>
<li>User can interrupt input blocking by pressing <code>Alt + F4</code> shortcut.
Always listen to <code>input_blocking_ended</code> event to handle such cases.</li>
</ol>
<h2 id="electron-input-redirection"><a class="header" href="#electron-input-redirection">Electron input redirection</a></h2>
<p>When using <code>@asdf-overlay/electron</code> package, utility for input redirection is provided.
By using <code>ElectronOverlayInput</code>, you can easily redirect captured input events to Electron's <code>BrowserWindow</code>.</p>
<p>Example:</p>
<pre><code class="language-typescript">import { Overlay } from '@asdf-overlay/core';
import { ElectronOverlayInput, type OverlayWindow } from '@asdf-overlay/electron';
import { BrowserWindow } from 'electron';

const overlay: Overlay = /* Attached Overlay instance */;
const windowId: number = /* Target window ID */;
const browserWindow: BrowserWindow = /* Target Electron BrowserWindow */;
const window: OverlayWindow = { id: windowId, overlay };

// Connect overlay input to Electron BrowserWindow.
const overlayInput = ElectronOverlayInput.connect(window, browserWindow.webContents);

// Control which input events to listen and redirect.
overlay.listenInput(windowId, true, true);

// Disconnect when no longer needed.
await overlayInput.disconnect();
</code></pre>
<p>Caveats:</p>
<ol>
<li>Due to limitations of Electron, some input events may not be redirected properly.</li>
<li>If <code>browserWindow</code> is not focused, some input events may not be redirected properly.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-user-guide"><a class="header" href="#rust-user-guide">Rust User Guide</a></h1>
<p>This section provides information on how to use Asdf Overlay with Rust.</p>
<ul>
<li><strong><a href="user-guide/./rust/installation.html">Installation</a></strong> Instructions on how to install Asdf Overlay for Rust.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation-1"><a class="header" href="#installation-1">Installation</a></h1>
<p>Following command can be used to install Rust crate</p>
<pre><code class="language-bash">cargo add asdf-overlay-client
</code></pre>
<p>TBA</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
